---
title: <span style="color:#034a94">**Practica 1**</span> 
output:
  html_document:
    toc: no
    toc_depth: 2
    toc_float: yes
    code_folding: hide
    css: style.css
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = NA)

c1 ="#3B566E"  # azul oscuro- color primario 
c2 ="#6487A5"  # azul claro- color secundario
c3 ="#2ED199"  # verdeclaro - color terciario
c4 ="#F2F2F2"  # gris muy claro - color texto
c5 ="#8DA9C4"  # azul claro 
c6= "#04BA80"  # verde claro
c7= "#0E9183"  # verde oscuro

library(readxl)

violencia_sex_2021 <-read_excel("data/Indicadores_Infancia_adolescencia_juventud_2021.xlsx", 
                                sheet = "Ind. Violencia Sexual", 
                                range = "B9:AJ2548")
```


```{r, echo=FALSE, out.width="100%", fig.align = "center"}
# knitr::include_graphics("img/banner000.png")
```

<br/><br/>


## <span style="color:#0E9183">**Introducción**</span>

<br/>

Con el fin de poner en practica lo visto en la sesión, se propone replicar las siguientes instrucciones en RStudio, ya se localmente (R-RStudio instalados en PC) o en la plataforma RStudio Cloud.

<br/><br/>

## <span style="color:#0E9183">**Desarrollo**</span>

<br/>

##### <span style="color:#6487A5">**Paso 1**</span>

* Abra RStudio o RStudio Cloud

<br/><br/>

##### <span style="color:#6487A5">**Paso 2**</span> 

* Cree un nuevo proyecto - Puede llamarlo **seminario**. Esto le permitirá tener todos los ejercicio realizados durante el seminario en una carpeta

<br/><br/>

##### <span style="color:#6487A5">**Paso 3**</span> 

* Dentro de la carpeta creada por el sistema (**seminario**), cree una carpeta llamada **data**

<br/><br/>

##### <span style="color:#6487A5">**Paso 4**</span> 

* Descargue del Observatorio de Violencia una base de datos  [Indicadores de Infancia, adolescencia y juventud Procuraduría 2021](https://www.medicinalegal.gov.co/indicadores-procuraduria#:~:text=Indicadores%20de%20Infancia%2C%20adolescencia%20y%20juventud%20Procuradur%C3%ADa%202021)

<br/><br/>

##### <span style="color:#6487A5">**Paso 5**</span>  

* Copie la base de datos descargada a la carpeta data creada dentro del proyecto **seminario** 

<br/><br/>

##### <span style="color:#6487A5">**Paso 6**</span> 

* Importe la hoja electrónica **Ind.violencia Sexual** contenida dentro del archivo descargado. Recuerde previamente verificar el rango dentro del cual se encuentra la información ( Import Dataset / From Excel.../). Ubique el archivo dentro de la carpeta **data**. (Browse..). Ubique la hoja seleccionada (Sheet : Ind. Violencia Sexual). Escriba el rango (B9:AJ2548) .  Import.

<br/><br/>

Note que en la ventana **console** sale el código relacionado con la importación de la base. Abra un script (documento en blanco para escribir los códigos). + verde ubicado en la esquina superior izquierda : R Script.

<br/><br/>

##### <span style="color:#6487A5">**Paso 7**</span> 

* Copie el código relacionado con la importación de la base de datos en el Script

<br/><br/>

> Indicadores_Infancia_adolescencia_juventud_2021 <- read_excel("data/Indicadores_Infancia_adolescencia_juventud_2021.xlsx", 
+     sheet = "Ind. Violencia Sexual", range = "B9:AJ2548")

</pre>

Elimine >  deje el codigo en una sola línea sin el mas y cambie el nombre de la base por  violencia_sex_2021, esto facilitará a futuro el llamado de la base.

<pre>

base222 <-read_excel("data/Indicadores_Infancia_adolescencia_juventud_2021.xlsx", sheet = "Ind. Violencia Sexual", range = "B9:AJ2548")

</pre>
<!-- B9:AJ2548 -->


```{r, warning=FALSE, message=FALSE}
library(readxl)
violencia_sex_2021 <-read_excel("data/Indicadores_Infancia_adolescencia_juventud_2021.xlsx",
                                sheet = "Ind. Violencia Sexual", 
                                range = "B9:AJ2548")
```



Listo, ya tenemos el primer paso que es la importación de la base



<br/><br/><br/>

## <span style="color:#0E9183">**Examinar la data**</span>

##### <span style="color:#6487A5">**Paso 8**</span> 

* Abrimos la base de datos importada y observamos como en una hoja de excel la base de datos

```{r, eval=FALSE}
View(violencia_sex_2021)
```

<pre>
View(violencia_sex_2021)
</pre>

<br/><br/>

##### <span style="color:#6487A5">**Paso 9**</span> 

* Revisamos la estructura de la data

```{r}
str(violencia_sex_2021)
```

<br/><br/>

##### <span style="color:#6487A5">**Paso 10**</span> 

* Revisamos los nombres de las variables y las guardamos en un objeto

```{r}
variables = names(violencia_sex_2021)

variables
```

<br/><br/>

##### <span style="color:#6487A5">**Paso 11**</span>  

* Cambiamos los nombre de las variables por otros corto y sin espacios

```{r, warning=FALSE, message=FALSE}
names(violencia_sex_2021)=c("cdep","cmun","indicador", "nomind","contexto", 
                            "periodo","edadR", "casos", "poblacion","tasa", 
                            "casosh",  "poblacionh", "tasah", "casosm", 
                            "poblacionm", "tasam", "casosNA", "poblacionNA", 
                            "tasaNA",   "rural", "urbana",  "sininfor", 
                            "desplazados", "otros", "discapacitados",    
                            "nodiscapacitados", "discapacitado.Sininformacion", 
                            "indigena", "negro", "palenquero", "raizal",  "ROM",
                            "Sinetnica", "Sininformación", "TOTAL", "tipo") 
```

<br/><br/>

##### <span style="color:#6487A5">**Paso 12**</span>  

* Quitamos la información repetida - variables repetidas

```{r}
# cheque de variables
names(violencia_sex_2021) 
```


```{r}
# vsex21 <- violencia_sex_2021[, c(1,2,4,5,6,7,8,11,12,14,15, 17,18, 19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34)]
vsex21 <- violencia_sex_2021[, c(1,2,4:8,11,12,14,15, 17:34)]
str(vsex21)
```

<br/><br/>

##### <span style="color:#6487A5">**Paso 13**</span>  

* Revisar si existen datos faltantes (NA)

```{r}
faltantes <- colSums(is.na(vsex21))
faltantes <- as.data.frame(faltantes) 
faltantes
```

```{r}
# install.packages("naniar")
library(naniar)
gg_miss_var(vsex21) # gráfico de datos faltantes
```

```{r}
summary(vsex21)
```
```{r}
# install.packages("naniar")
library(naniar)
gg_miss_var(vsex21) # grafico de datos faltantes
vsex21 <- vsex21[1:2454,]

```

<br/><br/>

#### <span style="color:#6487A5">**Pase 14**</span>  

* Se eliminan los registros con datos faltantes

```{r}
# install.packages("naniar")
library(naniar)
vsex21SINA <- na.omit(vsex21)  # elimina todos los valores con  NA
gg_miss_var(vsex21SINA) # gráfico de datos faltantes
```

<br/><br/>

##### <span style="color:#6487A5">**Paso 15**</span>  

* Guardamos la base resultante


```{r}
write.csv(vsex21, "data/violencia_sex_2021.csv")
```

<br/><br/><br/>

## <span style="color:#6487A5">**Resumen de código**</span> 

```{r, message=FALSE, warning=FALSE, eval=FALSE}
library(readxl)

violencia_sex_2021 <-read_excel("data/Indicadores_Infancia_adolescencia_juventud_2021.xlsx", 
                                sheet = "Ind. Violencia Sexual", 
                                range = "B9:AJ2548")


variables = names(violencia_sex_2021)

names(violencia_sex_2021)=c("cdep","cmun","indicador", "nomind","contexto", 
                            "periodo", "edadR", "casos", "poblacion","tasa", 
                            "casosh", "poblacionh", "tasah", "casosm", 
                            "poblacionm", "tasam", "casosNA", "poblacionNA", 
                            "tasaNA",   "rural", "urbana",  "sininfor", 
                            "desplazados", "otros", "discapacitados",    
                            "nodiscapacitados", "discapacitado.Sininformacion", 
                            "indigena", "negro", "palenquero", "raizal","ROM", 
                            "Sinetnica", "Sininformación", "TOTAL", "tipo") 



vsex21 <- violencia_sex_2021[, c(1,2,4:8,11,12,14,15, 17:34)]
str(vsex21)

faltantes <- colSums(is.na(vsex21))
faltantes <- as.data.frame(faltantes) 
faltantes

# install.packages("naniar")
library(naniar)
gg_miss_var(vsex21) # gráfico de datos faltantes



# install.packages("naniar")
library(naniar)
gg_miss_var(vsex21) # grafico de datos faltantes
vsex21 <- vsex21[1:2454,]


# install.packages("naniar")
library(naniar)
vsex21SINA <- na.omit(vsex21)  # elimina todos los valores con  NA
gg_miss_var(vsex21SINA) # gráfico de datos faltantes


write.csv(vsex21, "data/violencia_sex_2021.csv")

```

<br/><br/>

##### <span style="color:#6487A5">**Paso 16**</span>  

* Repita el anterior procedimiento para las bases correspondientes a los periodos 2022 y 2020 y guarde las bases con los nombres :

* data/violencia_sex_2022.csv
* data/violencia_sex_2020.csv

En la próxima sesión serán unidos 


<br/><br/><br/>

<div class="content-box-green">
### **NOTA**

En caso de utilizar RStudio Cloud, clone el repositorio github seminarioML con el siguiente enlace


`https://github.com/dgonxalex80/seminarioML.git`


</div>
