<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Manejo base de datos sobre violencia" />


<title>Modelo de base de datos IML</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"> </a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Curso
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    U1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="unidad1.html">Unidad1</a>
    </li>
    <li>
      <a href="recurso110.html">Conceptos básicos DM y ML</a>
    </li>
    <li>
      <a href="recurso120.html">Aplicaciones de DM</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    U2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="unidad2.html">Unidad 2</a>
    </li>
    <li>
      <a href="recurso210.html">Limpieza</a>
    </li>
    <li>
      <a href="recurso220.html">Integración y transformación</a>
    </li>
    <li>
      <a href="recurso230.html">Análisis exploratorio</a>
    </li>
    <li>
      <a href="recurso231.html">* Resumen estadístico</a>
    </li>
    <li>
      <a href="recurso232.html">* Análisis de correlaciones</a>
    </li>
    <li>
      <a href="recurso233.html">* Exploración datos faltantes</a>
    </li>
    <li>
      <a href="recurso234.html">* Detección datos atípicos</a>
    </li>
    <li>
      <a href="recurso235.html">* Análisis de tendencias</a>
    </li>
    <li>
      <a href="recurso240.html">Ejercicios sobre el modelo CNRV</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    U3
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="unidad3.html">Unidad 3</a>
    </li>
    <li>
      <a href="recurso310.html">Regresión lineal</a>
    </li>
    <li>
      <a href="recurso320.html">Árboles de decisión</a>
    </li>
    <li>
      <a href="recurso330.html">Random Forest</a>
    </li>
    <li>
      <a href="recurso340.html">Support Vector Machines</a>
    </li>
    <li>
      <a href="recurso350.html">Agrupamiento</a>
    </li>
    <li>
      <a href="recurso360.html">Reducción de dimensionalidad</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    U4
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="unidad4.html">Unidad 4</a>
    </li>
    <li>
      <a href="recurso410.html">Visualización</a>
    </li>
    <li>
      <a href="recurso420.html">Gráficos básicos</a>
    </li>
    <li>
      <a href="recurso430.html">Tableros</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    U5
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="unidad5.html">Unidad 5</a>
    </li>
    <li>
      <a href="recurso510.html">Análisis de causa de muertes</a>
    </li>
    <li>
      <a href="recurso520.html">Predicción de lesiones</a>
    </li>
    <li>
      <a href="recurso50.html">Identificación de patrones</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    U6
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="unidad6.html">Unidad 6</a>
    </li>
    <li>
      <a href="recurso900.html">Introducción a R</a>
    </li>
    <li>
      <a href="recurso901.html">Construcción de un proyecto en R</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="recurso620.html">Introducción a Python</a>
    </li>
  </ul>
</li>
<li>
  <a href="recurso700.html">Ref</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Proy
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="recurso800.html">Proyecto</a>
    </li>
    <li>
      <a href="practica201.html">Practiaca 01</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore"><span style="color:#034a94"><strong>Modelo
de base de datos IML</strong></span></h1>
<h3 class="subtitle">Unidad 2</h3>
<h4 class="author">Manejo base de datos sobre violencia</h4>

</div>


<p><br/><br/></p>
<p><br/><br/></p>
<p>En el objetivo de poner en practica lo desarrollado en el módulo, se
presenta la siguiente guía que puede ser ejecutada en RStudio Cloud o en
RStudio instaldo localmente.</p>
<p>El material utilizado durante el proceso tambien estará disponible en
el repositorio de github : <strong><a
href="https://github.com/dgonxalex80/seminarioML.git"
class="uri">https://github.com/dgonxalex80/seminarioML.git</a></strong></p>
<p>Se recomienda clonar el repositorio en RStudio (como se realzó en las
sesiones - ver videos)</p>
<p><br/><br/></p>
<div id="paso-1" class="section level2">
<h2><strong>Paso 1</strong></h2>
<div id="descargar-la-data-desde-el-observatorio"
class="section level3">
<h3><strong>DESCARGAR LA DATA DESDE EL OBSERVATORIO</strong></h3>
<p>Se descargan las bases de datos desde el observatorio de
violencia</p>
<p><img src="img/observatorio.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Y posteriormente se alojan todos libros de excel en el directorio
<code>data</code></p>
<p><br/><br/></p>
<p><img src="img/libros.png" width="100%" style="display: block; margin: auto;" /></p>
<p><br/><br/></p>
</div>
</div>
<div id="paso-2" class="section level2">
<h2><strong>Paso 2</strong></h2>
<div id="importar-la-información-de-los-libors-de-excel"
class="section level3">
<h3><strong>IMPORTAR LA INFORMACIÓN DE LOS LIBORS DE EXCEL</strong></h3>
<p>Para imprtar las base se realiza un visualizaciṕon de las hojas del
libro y la hoja electrónica, con el fin de tener claridad sobre el rango
que ocupa y así asignar los parámetros de la función de R a emplear</p>
<pre class="r"><code># 1. IMPORTAR LAS BASES DE DATOS

library(readxl) # paquete para leer libros de excel
vsex_2022 &lt;- read_excel(&quot;data/Indicadores_infancia_adolescencia_juventud_Procuraduria_2022.xlsx&quot;,  # nombre del archivo
                                 sheet = &quot;Ind. Violencia Sexual&quot;,  # nombre de la hoja corespondiente
                                 range = &quot;B9:AJ2548&quot;)   # rango que ocula la base

vsex_2021 &lt;-read_excel(&quot;data/Indicadores_Infancia_adolescencia_juventud_2021.xlsx&quot;, 
                                sheet = &quot;Ind. Violencia Sexual&quot;, 
                                range = &quot;B9:AJ2548&quot;)

vsex_2020 &lt;- read_excel(&quot;data/Indicadores infancia adolescencia y juventud Procuraduria 2020.xlsx&quot;, 
                                 sheet = &quot;Ind. Violencia Sexual&quot;,
                                 range = &quot;B9:AJ2237&quot;)


vsex_2019 &lt;- read_excel(&quot;data/Indicadores Procuraduria 2019.xlsx&quot;,
                                 sheet = &quot;Ind. Violencia Sexual&quot;, 
                                 range= &quot;B9:AJ2564&quot;)

vsex_2018 &lt;- read_excel(&quot;data/Indicadores Procuraduria 2018.xlsx&quot;,
                                 sheet = &quot;Ind. Violencia Sexual&quot;, 
                                 range= &quot;A8:AE2435&quot;)

vsex_2017 &lt;- read_excel(&quot;data/Indicadores Procuraduría 2017.xlsx&quot;, 
                                 sheet = &quot;Ind. Violencia Sexual&quot;, 
                                 range = &quot;B9:AO2382&quot;)

vsex_2017 &lt;- read_excel(&quot;data/Indicadores Procuraduría 2017.xlsx&quot;, 
                                 sheet = &quot;Ind. Violencia Sexual&quot;, 
                                 range = &quot;B9:AO2382&quot;)

vsex_2016 &lt;- read_excel(&quot;data/Indicadores Procuraduría 2016.xlsx&quot;, 
                                 sheet = &quot;Ind. Violencia Sexual&quot;, 
                                 range = &quot;B9:AO2228&quot;)

vsex_2015 &lt;- read_excel(&quot;data/Indicadores Procuraduría 2015.xlsx&quot;, 
                                 sheet = &quot;Ind. Violencia Sexual&quot;, 
                                 range = &quot;B9:AO2247&quot;)


vsex_2014 &lt;- read_excel(&quot;data/indicadores de Infancia, adolescencia y juventud 2014.xlsx&quot;, 
                                 sheet = &quot;BATERIA VIOLENCIA SEXUAL 2014&quot;, 
                                 range = &quot;A1:AE2203&quot;)

vsex_2013 &lt;- read_excel(&quot;data/indicadores de Infancia, adolescencia y juventud2011-2013.xlsx&quot;, 
                                 sheet = &quot;BATERIA IND. VIOLENCIA SEXUAL&quot;, 
                                 range = &quot;A1:AD16201&quot;)</code></pre>
<p><img src="img/importar1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>El resultado indica que se han cargado a RStudio 10 bases de datos
(vsex2013 que contiene información de los años 2011, 2012 y 2013) ….
vsex_2022</p>
<p><br/><br/></p>
</div>
</div>
<div id="paso-3" class="section level2">
<h2><strong>Paso 3</strong></h2>
<div id="inspección-de-las-bases-de-datos-importatas"
class="section level3">
<h3><strong>INSPECCIÓN DE LAS BASES DE DATOS IMPORTATAS</strong></h3>
<p>Con el fin de estudiar la estructura de las bases se emplea la
función de R str</p>
<pre class="r"><code>str(vsex_2022)</code></pre>
<pre><code>tibble [2,539 × 35] (S3: tbl_df/tbl/data.frame)
 $ Código Departamento              : num [1:2539] 91 91 91 91 91 91 91 91 91 91 ...
 $ Código Municipio                 : num [1:2539] 91405 91405 91407 91001 91001 ...
 $ Código indicador                 : num [1:2539] 81 81 81 81 81 81 121 121 81 81 ...
 $ Nombre del indicador             : chr [1:2539] &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; ...
 $ Contexto del hecho               : chr [1:2539] &quot;PRESUNTO DELITO SEXUAL&quot; &quot;PRESUNTO DELITO SEXUAL&quot; &quot;PRESUNTO DELITO SEXUAL&quot; &quot;PRESUNTO DELITO SEXUAL&quot; ...
 $ Periodo del Indicador            : num [1:2539] 2022 2022 2022 2022 2022 ...
 $ Rangos de edad o edades simples  : chr [1:2539] &quot;(06 a 11)&quot; &quot;(12 a 17)&quot; &quot;(12 a 17)&quot; &quot;(01 a 05)&quot; ...
 $ Numerador (casos)                : num [1:2539] 1 2 2 5 23 43 6 1 1 1 ...
 $ Denominador (Población)          : num [1:2539] 636 558 589 5754 6983 ...
 $ Resultado (Tasa)                 : num [1:2539] 157.2 358.4 339.6 86.9 329.4 ...
 $ Hombre Numerador (casos)         : num [1:2539] 0 0 0 1 4 7 1 0 0 0 ...
 $ Hombre Denominador (Población)   : num [1:2539] 340 302 297 2958 3545 ...
 $ Hombre Resultado (Tasa)          : num [1:2539] 0 0 0 33.8 112.8 ...
 $ Mujer Numerador (casos)          : num [1:2539] 1 2 2 4 19 36 5 1 1 1 ...
 $ Mujer Denominador (Población)    : num [1:2539] 296 256 292 2796 3438 ...
 $ Mujer Resultado (Tasa)           : num [1:2539] 338 781 685 143 553 ...
 $ Sin Datos Numerador (casos)      : num [1:2539] 0 0 0 0 0 0 0 0 0 0 ...
 $ Sin Datos Denominador (Población): num [1:2539] 0 0 0 0 0 0 0 0 0 0 ...
 $ Sin Datos Resultado (Tasa)       : num [1:2539] 0 0 0 0 0 0 0 0 0 0 ...
 $ Rural                            : num [1:2539] 1 2 2 2 3 12 1 0 1 0 ...
 $ Urbana                           : num [1:2539] 0 0 0 3 20 27 5 1 0 0 ...
 $ Sin información...22             : num [1:2539] 0 0 0 0 0 4 0 0 0 1 ...
 $ Desplazados (as)                 : num [1:2539] 0 0 0 0 0 0 0 0 0 0 ...
 $ Otros                            : num [1:2539] 1 2 2 5 23 43 6 1 1 1 ...
 $ Persona con discapacidad         : num [1:2539] 0 0 0 0 1 1 0 0 0 0 ...
 $ No discapacitado                 : num [1:2539] 1 2 2 5 22 42 6 1 1 1 ...
 $ Discapacitado
Sin información : num [1:2539] 0 0 0 0 0 0 0 0 0 0 ...
 $ Indígena                         : num [1:2539] 1 2 2 2 12 19 2 0 1 1 ...
 $ Negro/Afrodescendiente           : num [1:2539] 0 0 0 0 1 0 0 0 0 0 ...
 $ Palenquero                       : num [1:2539] 0 0 0 0 0 0 0 0 0 0 ...
 $ Raizal                           : num [1:2539] 0 0 0 0 0 0 0 0 0 0 ...
 $ ROM (Gitano)                     : num [1:2539] 0 0 0 0 0 0 0 0 0 0 ...
 $ Sin pertenencia étnica           : num [1:2539] 0 0 0 3 10 22 4 1 0 0 ...
 $ Sin información...34             : num [1:2539] 0 0 0 0 0 2 0 0 0 0 ...
 $ TOTAL                            : num [1:2539] 1 2 2 5 23 43 6 1 1 1 ...</code></pre>
<p>Este procedimiento permite visualizar:</p>
<ul>
<li>nombre de las variables</li>
<li>tipo de variable</li>
<li>dimensión</li>
<li>primeros valores</li>
</ul>
<p><br/><br/></p>
</div>
</div>
<div id="paso-4" class="section level2">
<h2><strong>Paso 4</strong></h2>
<div id="unión-de-las-bases" class="section level3">
<h3><strong>UNIÓN DE LAS BASES</strong></h3>
<p>Con este propósito se realizón una revisión de los nombres de las
variables para las 10 bases de datos</p>
<p><img src="img/nombres2.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Se observa que las bases conciden en 16 variables, requiriendo
realizar ajustes - adicionar o eliminar columnas - . Procedimiento que
se realiza a continuación</p>
<pre class="r"><code># # 02- SELECCION DE VARIABLES 

vsex22 &lt;- vsex_2022[, 1:16]
vsex21 &lt;- vsex_2021[, 1:16]
vsex20 &lt;- vsex_2020[, 1:16]
vsex19 &lt;- vsex_2019[, 1:16]
vsex18 &lt;- vsex_2018[, 1:16]
#------------------------------------
# Quitar variable - espacio en blanco
vsex17 &lt;- vsex_2017[, 1:17]
vsex16 &lt;- vsex_2016[, 1:17]

library(dplyr) # -------------------
vsex16 &lt;- vsex16 %&gt;%
            select(-11)

vsex17 &lt;- vsex17 %&gt;%
            select(-11)

#------------------------------------
# Adicionar variable faltante como NA 
vsex15 &lt;- vsex_2015[, 1:17]
vsex14 &lt;- vsex_2014[, 1:15]
vsex13 &lt;- vsex_2013[, 1:15]

vsex15 &lt;- vsex15 %&gt;%
            select(-11)

# Crear una nueva variable llena de NAs 2014
&#39;Contexto del hecho&#39; &lt;- rep(NA, nrow(vsex14))
vsex14 &lt;-cbind(vsex14[, 1:4], &#39;Contexto del hecho&#39;, vsex14[, 5:15])

vsex14 &lt;- vsex14 %&gt;%
  mutate_at(5, ~ NA)


# Crear una nueva variable llena de NAs 2013 - 2011
&#39;Contexto del hecho&#39; &lt;- rep(NA, nrow(vsex13))
vsex13 &lt;-cbind(vsex13[, 1:4], &#39;Contexto del hecho&#39;, vsex13[, 5:15])

names(vsex22)</code></pre>
<pre><code> [1] &quot;Código Departamento&quot;             &quot;Código Municipio&quot;               
 [3] &quot;Código indicador&quot;                &quot;Nombre del indicador&quot;           
 [5] &quot;Contexto del hecho&quot;              &quot;Periodo del Indicador&quot;          
 [7] &quot;Rangos de edad o edades simples&quot; &quot;Numerador (casos)&quot;              
 [9] &quot;Denominador (Población)&quot;         &quot;Resultado (Tasa)&quot;               
[11] &quot;Hombre Numerador (casos)&quot;        &quot;Hombre Denominador (Población)&quot; 
[13] &quot;Hombre Resultado (Tasa)&quot;         &quot;Mujer Numerador (casos)&quot;        
[15] &quot;Mujer Denominador (Población)&quot;   &quot;Mujer Resultado (Tasa)&quot;         </code></pre>
<p><br/><br/></p>
</div>
</div>
<div id="paso-5" class="section level2">
<h2><strong>Paso 5</strong></h2>
<div id="cambio-del-nombre-de-las-variables" class="section level3">
<h3><strong>CAMBIO DEL NOMBRE DE LAS VARIABLES</strong></h3>
<p>Con el fin de acortar el nombre de las variables por unos que no
contengan espacios en blanco, facilitando el manejo posterior se
promomen los siguientes nombres</p>
<pre class="r"><code>names(vsex13) = c(&quot;cdep&quot;,&quot;cmun&quot;,&quot;cindica&quot;, &quot;nomind&quot;,&quot;contexto&quot;, &quot;periodo&quot;,
                 &quot;edadR&quot;, &quot;casos&quot;, &quot;poblacion&quot;,&quot;tasa&quot;, &quot;casosh&quot;, &quot;poblacionh&quot;, 
                 &quot;tasah&quot;, &quot;casosm&quot;, &quot;poblacionm&quot;, &quot;tasam&quot;) 

names(vsex14) = c(&quot;cdep&quot;,&quot;cmun&quot;,&quot;cindica&quot;, &quot;nomind&quot;,&quot;contexto&quot;, &quot;periodo&quot;,
                  &quot;edadR&quot;, &quot;casos&quot;, &quot;poblacion&quot;,&quot;tasa&quot;, &quot;casosh&quot;, &quot;poblacionh&quot;, 
                  &quot;tasah&quot;, &quot;casosm&quot;, &quot;poblacionm&quot;, &quot;tasam&quot;) 

names(vsex15) = c(&quot;cdep&quot;,&quot;cmun&quot;,&quot;cindica&quot;, &quot;nomind&quot;,&quot;contexto&quot;, &quot;periodo&quot;,
                  &quot;edadR&quot;, &quot;casos&quot;, &quot;poblacion&quot;,&quot;tasa&quot;, &quot;casosh&quot;, &quot;poblacionh&quot;, 
                  &quot;tasah&quot;, &quot;casosm&quot;, &quot;poblacionm&quot;, &quot;tasam&quot;) 

names(vsex16) = c(&quot;cdep&quot;,&quot;cmun&quot;,&quot;cindica&quot;, &quot;nomind&quot;,&quot;contexto&quot;, &quot;periodo&quot;,
                  &quot;edadR&quot;, &quot;casos&quot;, &quot;poblacion&quot;,&quot;tasa&quot;, &quot;casosh&quot;, &quot;poblacionh&quot;, 
                  &quot;tasah&quot;, &quot;casosm&quot;, &quot;poblacionm&quot;, &quot;tasam&quot;) 

names(vsex17) = c(&quot;cdep&quot;,&quot;cmun&quot;,&quot;cindica&quot;, &quot;nomind&quot;,&quot;contexto&quot;, &quot;periodo&quot;,
                  &quot;edadR&quot;, &quot;casos&quot;, &quot;poblacion&quot;,&quot;tasa&quot;, &quot;casosh&quot;, &quot;poblacionh&quot;, 
                  &quot;tasah&quot;, &quot;casosm&quot;, &quot;poblacionm&quot;, &quot;tasam&quot;) 

names(vsex18) = c(&quot;cdep&quot;,&quot;cmun&quot;,&quot;cindica&quot;, &quot;nomind&quot;,&quot;contexto&quot;, &quot;periodo&quot;,
                  &quot;edadR&quot;, &quot;casos&quot;, &quot;poblacion&quot;,&quot;tasa&quot;, &quot;casosh&quot;, &quot;poblacionh&quot;, 
                  &quot;tasah&quot;, &quot;casosm&quot;, &quot;poblacionm&quot;, &quot;tasam&quot;) 

names(vsex19) = c(&quot;cdep&quot;,&quot;cmun&quot;,&quot;cindica&quot;, &quot;nomind&quot;,&quot;contexto&quot;, &quot;periodo&quot;,
                  &quot;edadR&quot;, &quot;casos&quot;, &quot;poblacion&quot;,&quot;tasa&quot;, &quot;casosh&quot;, &quot;poblacionh&quot;, 
                  &quot;tasah&quot;, &quot;casosm&quot;, &quot;poblacionm&quot;, &quot;tasam&quot;) 

names(vsex20) = c(&quot;cdep&quot;,&quot;cmun&quot;,&quot;cindica&quot;, &quot;nomind&quot;,&quot;contexto&quot;, &quot;periodo&quot;,
                  &quot;edadR&quot;, &quot;casos&quot;, &quot;poblacion&quot;,&quot;tasa&quot;, &quot;casosh&quot;, &quot;poblacionh&quot;, 
                  &quot;tasah&quot;, &quot;casosm&quot;, &quot;poblacionm&quot;, &quot;tasam&quot;) 

names(vsex21) = c(&quot;cdep&quot;,&quot;cmun&quot;,&quot;cindica&quot;, &quot;nomind&quot;,&quot;contexto&quot;, &quot;periodo&quot;,
                  &quot;edadR&quot;, &quot;casos&quot;, &quot;poblacion&quot;,&quot;tasa&quot;, &quot;casosh&quot;, &quot;poblacionh&quot;, 
                  &quot;tasah&quot;, &quot;casosm&quot;, &quot;poblacionm&quot;, &quot;tasam&quot;) 

names(vsex22) = c(&quot;cdep&quot;,&quot;cmun&quot;,&quot;cindica&quot;, &quot;nomind&quot;,&quot;contexto&quot;, &quot;periodo&quot;,
                  &quot;edadR&quot;, &quot;casos&quot;, &quot;poblacion&quot;,&quot;tasa&quot;, &quot;casosh&quot;, &quot;poblacionh&quot;, 
                  &quot;tasah&quot;, &quot;casosm&quot;, &quot;poblacionm&quot;, &quot;tasam&quot;) 

names(vsex22)</code></pre>
<pre><code> [1] &quot;cdep&quot;       &quot;cmun&quot;       &quot;cindica&quot;    &quot;nomind&quot;     &quot;contexto&quot;  
 [6] &quot;periodo&quot;    &quot;edadR&quot;      &quot;casos&quot;      &quot;poblacion&quot;  &quot;tasa&quot;      
[11] &quot;casosh&quot;     &quot;poblacionh&quot; &quot;tasah&quot;      &quot;casosm&quot;     &quot;poblacionm&quot;
[16] &quot;tasam&quot;     </code></pre>
</div>
</div>
<div id="paso-6" class="section level2">
<h2><strong>Paso 6</strong></h2>
<div id="union-de-las-bases-de-datos" class="section level3">
<h3><strong>UNION DE LAS BASES DE DATOS</strong></h3>
<p>En este paso se emplea la funcion rbind() . Esta función requiere que
las bases a unir tengan el mismo número de variables y que sus nombre
sean iguales.</p>
<pre class="r"><code>vsex = rbind(vsex13,
                      vsex14,
                      vsex15,
                      vsex16,
                      vsex17,
                      vsex18,
                      vsex19,
                      vsex20,
                      vsex21,
                      vsex22)

str(vsex)</code></pre>
<pre><code>&#39;data.frame&#39;:   37520 obs. of  16 variables:
 $ cdep      : num  91 91 91 91 91 91 91 5 5 5 ...
 $ cmun      : num  91263 91405 91407 91001 91540 ...
 $ cindica   : num  81 81 81 81 81 81 81 81 81 81 ...
 $ nomind    : chr  &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; ...
 $ contexto  : chr  &quot;Contexto del hecho&quot; &quot;Contexto del hecho&quot; &quot;Contexto del hecho&quot; &quot;Contexto del hecho&quot; ...
 $ periodo   : num  2011 2011 2011 2011 2011 ...
 $ edadR     : chr  &quot;(01 a 05)&quot; &quot;(01 a 05)&quot; &quot;(01 a 05)&quot; &quot;(01 a 05)&quot; ...
 $ casos     : chr  &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;13&quot; ...
 $ poblacion : chr  &quot;649&quot; &quot;548&quot; &quot;753&quot; &quot;4803&quot; ...
 $ tasa      : num  0 0 0 271 0 ...
 $ casosh    : chr  &quot;-&quot; &quot;-&quot; &quot;-&quot; &quot;2&quot; ...
 $ poblacionh: chr  &quot;318&quot; &quot;276&quot; &quot;378&quot; &quot;2464&quot; ...
 $ tasah     : chr  &quot;0,00&quot; &quot;0,00&quot; &quot;0,00&quot; &quot;81,17&quot; ...
 $ casosm    : chr  &quot;-&quot; &quot;-&quot; &quot;-&quot; &quot;11&quot; ...
 $ poblacionm: chr  &quot;331&quot; &quot;272&quot; &quot;375&quot; &quot;2339&quot; ...
 $ tasam     : chr  &quot;0,00&quot; &quot;0,00&quot; &quot;0,00&quot; &quot;470,29&quot; ...</code></pre>
<pre class="r"><code>table(vsex$periodo)</code></pre>
<pre><code>
2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022 
5400 5400 5400 2202 2238 2219 2373 2427 2555 2228 2454 2539 </code></pre>
<p><br/><br/></p>
</div>
</div>
<div id="paso-7" class="section level2">
<h2><strong>Paso 7</strong></h2>
<div id="ajustes-de-variables" class="section level3">
<h3><strong>AJUSTES DE VARIABLES</strong></h3>
<p>Al revisar el tipo de las variables, se observó que la variables
edadR presentava la siguiente inconsistencia :</p>
<pre class="r"><code>table(vsex$edadR)</code></pre>
<pre><code>
        (01 a 05)         (06 a 11)         (12 a 17)         (18 a 28) 
             7328              9396             10274              6949 
 Menores de 1 año Menores de un año 
             3240               248 </code></pre>
<p>Con el fin de corregir el problema se convierte la variable de
caracter a numérica con el fin de que conserve el orden en las tablas y
en los gráficos</p>
<pre class="r"><code>vsex$edadR[vsex$edadR == &quot;Menores de 1 año&quot;] = 1
vsex$edadR[vsex$edadR == &quot;Menores de un año&quot;] = 1
vsex$edadR[vsex$edadR == &quot;(01 a 05)&quot;] =2
vsex$edadR[vsex$edadR == &quot;(06 a 11)&quot;] =3
vsex$edadR[vsex$edadR == &quot;(12 a 17)&quot;] =4
vsex$edadR[vsex$edadR == &quot;(18 a 28)&quot;] =5

tedadR =table(vsex$edadR)
names(tedadR) = c(&quot;menos 1&quot;, &quot;1-5&quot;, &quot;6-11&quot;, &quot;12-17&quot;, &quot;18-28&quot;)
tedadR</code></pre>
<pre><code>menos 1     1-5    6-11   12-17   18-28 
   3488    7328    9396   10274    6949 </code></pre>
<pre class="r"><code>barplot(tedadR)</code></pre>
<p><img src="recurso240_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
</div>
<div id="paso-8" class="section level2">
<h2><strong>Paso 8</strong></h2>
<div id="detección-de-datos-faltantes" class="section level3">
<h3><strong>DETECCIÓN DE DATOS FALTANTES</strong></h3>
<pre class="r"><code>library(dplyr)
faltantes &lt;- colSums(is.na(vsex)) %&gt;%
                  data.frame()
faltantes</code></pre>
<pre><code>              .
cdep         85
cmun         85
cindica      85
nomind       85
contexto   2287
periodo      85
edadR        85
casos        85
poblacion   104
tasa        104
casosh       85
poblacionh  104
tasah       104
casosm       85
poblacionm  104
tasam       104</code></pre>
<p>Antes de pensar en eliminar la variables contexto, dado el gran
número de datos faltantes (NA), se explora su distribución</p>
<pre class="r"><code>table(vsex$contexto, vsex$edadR)</code></pre>
<pre><code>                        
                            1    2    3    4    5
  Contexto del hecho     3240 3240 3240 3240 3240
  PRESUNTO DELITO SEXUAL  223 3656 5516 6294 3344</code></pre>
<pre class="r"><code>table(vsex$contexto, vsex$cindica)</code></pre>
<pre><code>                        
                            81   121
  Contexto del hecho     12960  3240
  PRESUNTO DELITO SEXUAL 15689  3344</code></pre>
<pre class="r"><code>table(vsex$contexto, vsex$periodo)</code></pre>
<pre><code>                        
                         2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021
  Contexto del hecho     5400 5400 5400    0    0    0    0    0    0    0    0
  PRESUNTO DELITO SEXUAL    0    0    0    0 2238 2219 2373 2427 2555 2228 2454
                        
                         2022
  Contexto del hecho        0
  PRESUNTO DELITO SEXUAL 2539</code></pre>
<p>Se puede ver claramente que la variables contexto está relacionada
con la variable periodo y que se puede eliminar sin afectar el contenido
de la información contenida en la base vsex</p>
<pre class="r"><code>vsex &lt;- vsex %&gt;%
            select(-5)
str(vsex)</code></pre>
<pre><code>&#39;data.frame&#39;:   37520 obs. of  15 variables:
 $ cdep      : num  91 91 91 91 91 91 91 5 5 5 ...
 $ cmun      : num  91263 91405 91407 91001 91540 ...
 $ cindica   : num  81 81 81 81 81 81 81 81 81 81 ...
 $ nomind    : chr  &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; &quot;Tasa de exámenes médico legales por presunto delito sexual contra niños, niñas y adolescentes&quot; ...
 $ periodo   : num  2011 2011 2011 2011 2011 ...
 $ edadR     : chr  &quot;2&quot; &quot;2&quot; &quot;2&quot; &quot;2&quot; ...
 $ casos     : chr  &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;13&quot; ...
 $ poblacion : chr  &quot;649&quot; &quot;548&quot; &quot;753&quot; &quot;4803&quot; ...
 $ tasa      : num  0 0 0 271 0 ...
 $ casosh    : chr  &quot;-&quot; &quot;-&quot; &quot;-&quot; &quot;2&quot; ...
 $ poblacionh: chr  &quot;318&quot; &quot;276&quot; &quot;378&quot; &quot;2464&quot; ...
 $ tasah     : chr  &quot;0,00&quot; &quot;0,00&quot; &quot;0,00&quot; &quot;81,17&quot; ...
 $ casosm    : chr  &quot;-&quot; &quot;-&quot; &quot;-&quot; &quot;11&quot; ...
 $ poblacionm: chr  &quot;331&quot; &quot;272&quot; &quot;375&quot; &quot;2339&quot; ...
 $ tasam     : chr  &quot;0,00&quot; &quot;0,00&quot; &quot;0,00&quot; &quot;470,29&quot; ...</code></pre>
<pre class="r"><code>library(dplyr)
faltantes &lt;- colSums(is.na(vsex)) %&gt;%
                  data.frame()
faltantes</code></pre>
<pre><code>             .
cdep        85
cmun        85
cindica     85
nomind      85
periodo     85
edadR       85
casos       85
poblacion  104
tasa       104
casosh      85
poblacionh 104
tasah      104
casosm      85
poblacionm 104
tasam      104</code></pre>
<pre class="r"><code>vsex &lt;- na.omit(vsex)

# install.packages(&quot;naniar&quot;)
library(naniar)
gg_miss_var(vsex) # grafico de datos faltantes</code></pre>
<p><img src="recurso240_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code>table(vsex$periodo)</code></pre>
<pre><code>
2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022 
5400 5400 5400 2202 2238 2219 2370 2424 2552 2226 2450 2535 </code></pre>
<p><br/><br/></p>
</div>
</div>
<div id="paso-9" class="section level2">
<h2><strong>Paso 9</strong></h2>
<div id="guardado-de-la-base-de-datos" class="section level3">
<h3><strong>GUARDADO DE LA BASE DE DATOS</strong></h3>
<p>Realizado los ajustes a la base de datos se procede a guardar la base
de datos</p>
<pre class="r"><code>write.csv(vsex, &quot;bases/vsex.csv&quot;)
saveRDS(vsex, &quot;bases/vsex.RDS&quot;)</code></pre>
<p><br/><br/></p>
</div>
</div>
<div id="paso-10" class="section level2">
<h2><strong>Paso 10</strong></h2>
<div id="exploración-de-los-datos" class="section level3">
<h3><strong>EXPLORACIÓN DE LOS DATOS</strong></h3>
<p>Con el fin de contrastar el contenido de la base de datos con el
conocimiento externo que poseen los usuarios de la información se
realizan las siguientes tablas, resumenes y gráficas</p>
<p>Empezaremos con una tabla de departamento por periodo</p>
<pre class="r"><code>t1 &lt;- table(vsex$cdep,vsex$periodo)
t1</code></pre>
<pre><code>     
      2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022
  5    635  635  635  301  285  231  305  310  311  290  309  330
  8    115  115  115   58   64   64   73   67   69   70   73   66
  11     5    5    5    5    5    5    5    5    5    5    5    5
  13   215  215  215   93  104  101  106   98  109   81  106  100
  15   535  535  535  116  151  150  150  149  175  139  175  176
  17   135  135  135   63   62   61   56   66   65   54   75   70
  18    80   80   80   27   23   39   35   38   44   40   43   47
  19   205  205  205   80   69   81   82   81   83   93   90  104
  20   125  125  125   68   67   62   71   70   70   58   61   69
  23   150  150  150   70   76   79   84   86   83   75   85   79
  25   580  580  580  259  257  278  269  276  284  252  278  292
  27   130  130  130   44   40   50   41   53   55   33   37   46
  41   185  185  185   92   83   79   91   95  102   81   90  106
  44    75   75   75   41   48   46   44   50   49   43   44   42
  47   150  150  150   55   58   60   58   59   61   45   50   55
  50   155  155  155   79   71   75   81   82   86   82   80   74
  52   305  305  305   80   60   49   37   40   45   24   31   31
  54   195  195  195   58   66   59   84   72   79   68   77   81
  63    60   60   60   34   38   38   39   41   43   39   39   43
  66    70   70   70   43   44   45   48   42   45   42   40   44
  68   430  430  430  148  156  160  160  159  169  156  172  162
  70   125  125  125   61   70   66   71   66   73   58   65   69
  73   240  240  240   79   84   90  109  132  148  141  142  142
  76   210  210  210  130  122  132  134  130  132  124  135  139
  81    35   35   35   15   22   23   24   26   26   27   23   25
  85    90   90   90   45   46   31   44   52   55   39   48   52
  86    65   65   65   33   36   31   31   37   41   37   34   40
  88    10   10   10    4    4    4    5    5    5    4    5    5
  91    35   35   35    9    8   10   10   12    8    5    8   13
  94     5    5    5    0    5    6    6    7   11    7    5    6
  95    20   20   20    6    7   10    9   10   14    7   13   10
  97     5    5    5    0    0    0    5    1    3    5    8    4
  99    15   15   15    6    7    4    3    7    4    2    4    8
  999   10   10   10    0    0    0    0    0    0    0    0    0</code></pre>
<pre class="r"><code># heatmap(t1, col = c(&quot;white&quot;, &quot;red&quot;), symkey = FALSE)</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
